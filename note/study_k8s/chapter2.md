클러스터를 직접 배포해보면서 도커, 깃, Go, 컨테이너 레지스트리, kubectl 도구를 알아보자.

# Minikube

https://minikube.sigs.k8s.io/docs/start/?arch=%2Fmacos%2Farm64%2Fstable%2Fbinary+download

# kubectl

쿠버네티스 API를 사용하여 쿠버네티스 클러스터의 컨트롤 플레인과 통신하기 위한 커맨드라인 툴 `kubectl`

# 클러스터 아키텍처

쿠버네티스는 여러 대의 서버가 하나의 클러스터로 연결되어 있다.
https://kubernetes.io/docs/concepts/overview/components/

## 컨트롤 플레인

컨트롤 플레인은 클러스터의 두뇌 역할을 하며 컨테이너 스케줄링, 서비스 관리, API 요청 처리 등의 작업을 수행한다.

컨트롤 플레인은 다음과 같은 컴포넌트로 구성된다.

- kube-apiserver: 컨트롤 플레인의 프론트엔드 서버로 API 요청을 처리
- etcd: 쿠버네티스와 관련된 모든 정보를 저장하는 키-벨류 형태의 데이터베이스
- kube-scheduler: 새로 생성된 파드를 실행할 노드를 결정해주는 컴포넌트
- kube-controller-manager: 디플로이먼트와 같은 리소스 컨트롤러를 관리하는 매니저
- cloud-controller-manager: 각종 CSP 들의 다양한 리소스를 지원하기 위한 컨트롤러 매니저 (옵셔널)

## 노드 컴포넌트

쿠버네티스 클러스터는 컨트롤 플레인과 다른 클러스터 내에서 사용자의 워크로드를 실행하는 워커 노드가 존재한다. 각 워커 노드는 다음과 같은 컴포넌트를 실행한다.

- kubelet: 노드에 예약된 워크로드를 실행하기 위해 컨테이너 런타임을 관리하고 상태를 모니터링한다.
- kube-proxy: 서로 다른 노드에 있는 파드 간 통신이나 파드와 인터넷 사이의 네트워크 트래픽을 라우팅한다.
- 컨테이너 런타임: 컨테이너를 시작하고 중지하며 컨테이너 간 통신을 처리한다. Container Runtime Interface (CRI)가 표준화되며 containerd 가 표준, Red Hat OpenShift에서 CRI-O 사용.

![Components of Kubernetes](https://kubernetes.io/images/docs/components-of-kubernetes.svg)

### etcd 를 통한 고가용성

etcd 데이터베이스는 여러 노드에 걸쳐 복제된다. etcd 복제본의 절반 이상이 사용 가능한 상태라면 개별 etcd 노드 장애에도 고가용성을 보장한다.

#### 컨트롤 플레인 장애

컨트롤 플레인 장애는 사용자의 애플리케이션을 다운 시키지는 않지만 이상 행동을 유발할 수 있다. 예를 들어 클러스터의 모든 마스터 노드를 중지할 경우 워커 노드의 파드는 한동안 계속 실행된다. 그러나 새로운 컨테이너를 배포하거나 쿠버네티스 리소스를 변경할 수는 없으며 디플로이먼트와 같은 컨트롤러는 중지될 것이다.

#### 워커 노드 장애

워커 노드 장애는 상대적으로 중요하지 않다. 컨트롤 플레인이 작동하고 있다면 쿠버네티스가 워커 노드의 장애를 감지하고 해당 노드의 파드를 다른 노드로 재조정한다.

# kops

kops는 쿠버네티스 클러스터의 자동 프로비저닝을 위한 cli 도구로 쿠버네티스 프로젝트의 일부이며 AWS 전용 도구로 오랫동안 사용되어 왔지만 구글 클라우드 또한 지원하고 있다.

상용 쿠버네티스 배포에 적합한 고가용성 클러스터 구축을 지원하며 쿠버네티스 자원과 같이 선언적 구성을 사용하며 클러스터를 설치하고 클라우드 자원을 프로비저닝할 뿐만 아니라 스케일링, 노드 재조정과 업그레이드 등 관리 작업을 수행할 수 있다.

# Kubespray

Kubespray는 쿠버네티스 산하 프로젝트로 상용 클러스터를 쉽게 배포하는 Ansible 기반 도구로 고가용성과 다중 플랫폼을 지원한다. 온프레미스 베어 메탈 서버에 쿠버네티스를 설치하는데 중점을 둔다.

# kubeadm

쿠버네티스 프로젝트에서 공식으로 제공하는 클러스터 부트스트랩 도구 완전히 모든 걸 다 해주는 올인원 도구는 아니고, 클러스터의 기본 뼈대(컨트롤 플레인과 워커 노드 조인)를 만드는 데 집중 한다.
